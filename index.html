<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connections Game</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            background-color: #f4f4f9;
            color: #333;
        }

        #game-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        h1 {
            color: #4a4a4a;
        }

        #instructions {
            margin-bottom: 20px;
            text-align: center;
            max-width: 600px;
            padding: 10px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        #word-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 20px;
            width: 400px; /* Adjust as needed */
        }

        .word-button {
            background-color: #fff;
            border: 2px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s, transform 0.2s;
            user-select: none; /* Prevent text selection */
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .word-button:hover {
            background-color: #e9e9e9;
        }

        .word-button.selected {
            background-color: #5c9aff; /* Blue for selected */
            color: white;
            border-color: #4a88e8;
            transform: scale(1.05);
        }

        .word-button.correct-group-animation {
            animation: bounceAndStay 0.8s forwards;
        }

        @keyframes bounceAndStay {
            0%, 20%, 50%, 80%, 100% {transform: translateY(0);}
            40% {transform: translateY(-20px);}
            60% {transform: translateY(-10px);}
        }


        #controls {
            margin-bottom: 20px;
        }

        #controls button {
            padding: 10px 15px;
            font-size: 1em;
            margin: 0 5px;
            cursor: pointer;
            background-color: #78c2ad;
            color: white;
            border: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        #controls button:hover {
            background-color: #67a894;
        }

        #mistakes-counter, #results-area {
            margin-bottom: 10px;
        }

        #mistakes-counter span {
            font-weight: bold;
            font-size: 1.2em;
        }

        .category-display {
            width: 400px; /* Match grid width */
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            text-align: center;
            color: white;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        /* Category Colors */
        .category-yellow { background-color: #f7b731; } /* Yellow */
        .category-green { background-color: #4caf50; } /* Green */
        .category-blue { background-color: #2196f3; } /* Blue */
        .category-purple { background-color: #9c27b0; } /* Purple */

        .category-words {
            font-size: 0.9em;
            font-weight: normal;
            margin-top: 5px;
        }

        #game-over-message {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 20px;
            padding: 20px;
            background-color: #ffdddd;
            border: 1px solid #ffaaaa;
            border-radius: 8px;
            text-align: center;
            display: none; /* Hidden by default */
        }

        #win-message {
            font-size: 1.5em;
            font-weight: bold;
            margin-top: 20px;
            padding: 20px;
            background-color: #ddffdd;
            border: 1px solid #aaffaa;
            border-radius: 8px;
            text-align: center;
            display: none; /* Hidden by default */
        }


    </style>
</head>
<body>

    <div id="game-container">
        <h1>Connections Challenge</h1>

        <div id="instructions">
            <p>Find groups of four words that share something in common!</p>
            <p>Select four words and click "Submit" to guess a category.</p>
            <p>Each puzzle has four categories.</p>
        </div>

        <div id="mistakes-counter">
            Mistakes remaining: <span id="mistakes-left">4</span>
        </div>

        <div id="word-grid">
            </div>

        <div id="controls">
            <button id="shuffle-button">Shuffle</button>
            <button id="deselect-button">Deselect All</button>
            <button id="submit-button">Submit</button>
        </div>

        <div id="results-area">
            </div>

        <div id="game-over-message">
            Game Over! Better luck next time.
            <p>The categories were:</p>
            <div id="game-over-categories"></div>
        </div>
        <div id="win-message">
            Congratulations! You solved the puzzle!
        </div>

    </div>

    <script>
        // --- Game Data (Categories and Words) ---
        const categories = [
            { name: "MUSICAL INSTRUMENTS", words: ["TRUMPET", "GUITAR", "PIANO", "DRUMS"], color: "category-yellow" },
            { name: "FRUITS", words: ["APPLE", "BANANA", "CHERRY", "GRAPE"], color: "category-green" },
            { name: "WEATHER PHENOMENA", words: ["RAIN", "SNOW", "WIND", "SUN"], color: "category-blue" },
            { name: "THINGS WITH WINGS", words: ["BIRD", "PLANE", "BAT", "ANGEL"], color: "category-purple" }
        ];

        // --- Game State ---
        let allWords = [];
        let selectedWords = [];
        let mistakesLeft = 4;
        let categoriesFound = 0;

        // --- DOM Elements ---
        const wordGrid = document.getElementById('word-grid');
        const shuffleButton = document.getElementById('shuffle-button');
        const deselectButton = document.getElementById('deselect-button');
        const submitButton = document.getElementById('submit-button');
        const mistakesLeftSpan = document.getElementById('mistakes-left');
        const resultsArea = document.getElementById('results-area');
        const gameOverMessage = document.getElementById('game-over-message');
        const gameOverCategoriesDiv = document.getElementById('game-over-categories');
        const winMessage = document.getElementById('win-message');

        // --- Functions ---

        // Fisher-Yates Shuffle Algorithm
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function initializeGame() {
            allWords = [];
            categories.forEach(cat => allWords.push(...cat.words));
            shuffleArray(allWords);
            renderWordGrid();
            mistakesLeft = 4;
            categoriesFound = 0;
            mistakesLeftSpan.textContent = mistakesLeft;
            resultsArea.innerHTML = '';
            selectedWords = [];
            gameOverMessage.style.display = 'none';
            winMessage.style.display = 'none';
            gameOverCategoriesDiv.innerHTML = '';
            enableGameControls();
        }

        function renderWordGrid() {
            wordGrid.innerHTML = ''; // Clear previous grid
            allWords.forEach(word => {
                if (!word.found) { // Only render words not yet in a found category
                    const button = document.createElement('button');
                    button.classList.add('word-button');
                    button.textContent = word;
                    button.dataset.word = word; // Store the word in a data attribute
                    button.addEventListener('click', handleWordSelection);
                    wordGrid.appendChild(button);
                }
            });
        }

        function handleWordSelection(event) {
            const selectedButton = event.target;
            const word = selectedButton.dataset.word;

            if (selectedWords.includes(word)) {
                // Deselect word
                selectedWords = selectedWords.filter(w => w !== word);
                selectedButton.classList.remove('selected');
            } else {
                // Select word
                if (selectedWords.length < 4) {
                    selectedWords.push(word);
                    selectedButton.classList.add('selected');
                }
            }
        }

        function deselectAllWords() {
            selectedWords = [];
            document.querySelectorAll('.word-button.selected').forEach(button => {
                button.classList.remove('selected');
            });
        }

        function handleSubmit() {
            if (selectedWords.length !== 4) {
                alert("Please select exactly 4 words.");
                return;
            }

            let correctCategory = null;
            for (const category of categories) {
                const isMatch = selectedWords.every(word => category.words.includes(word)) &&
                                category.words.every(word => selectedWords.includes(word));
                if (isMatch) {
                    correctCategory = category;
                    break;
                }
            }

            if (correctCategory) {
                // Mark words as found (so they are not re-rendered or re-shuffled)
                // and apply temporary animation
                selectedWords.forEach(wordValue => {
                    const button = wordGrid.querySelector(`.word-button[data-word="${wordValue}"]`);
                    if (button) {
                        button.classList.add('correct-group-animation');
                        button.style.backgroundColor = getComputedStyle(document.documentElement).getPropertyValue(`--${correctCategory.color.replace('category-', '')}-bg`) || correctCategory.color.split('-')[1]; // Fallback
                        button.style.color = 'white';
                        button.disabled = true; // Disable after correct
                    }
                    // Find the word in allWords and mark it as part of a found category
                    const wordObj = allWords.find(w => w === wordValue);
                    if(wordObj) wordObj.found = true; // This assumes allWords contains objects or needs adjustment
                });


                // Create a new div for the found category and add it to the top of resultsArea
                const categoryDiv = document.createElement('div');
                categoryDiv.classList.add('category-display', correctCategory.color);
                categoryDiv.innerHTML = `
                    <strong>${correctCategory.name}</strong>
                    <div class="category-words">${correctCategory.words.join(', ')}</div>
                `;
                resultsArea.insertBefore(categoryDiv, resultsArea.firstChild);


                // Remove found words from the grid display logic after animation
                setTimeout(() => {
                    // Hide the words that were correctly guessed
                    selectedWords.forEach(wordValue => {
                         const button = wordGrid.querySelector(`.word-button[data-word="${wordValue}"]`);
                         if(button) button.style.visibility = 'hidden'; // Hide instead of removing for layout stability
                    });

                    categoriesFound++;
                    deselectAllWords(); // Clear selection
                    // Do not re-render grid here, as we are just hiding elements.
                    // If you were removing elements, you would re-render.

                    if (categoriesFound === categories.length) {
                        winMessage.style.display = 'block';
                        disableGameControls();
                    }
                }, 800); // Match animation duration


            } else {
                mistakesLeft--;
                mistakesLeftSpan.textContent = mistakesLeft;
                if (mistakesLeft === 0) {
                    revealAllCategories();
                    gameOverMessage.style.display = 'block';
                    disableGameControls();
                } else {
                    // Add a shake animation for wrong guess (optional)
                    wordGrid.classList.add('shake-animation');
                    setTimeout(() => {
                        wordGrid.classList.remove('shake-animation');
                    }, 500);
                    deselectAllWords(); // Deselect after wrong guess
                }
            }
        }

        function revealAllCategories() {
            gameOverCategoriesDiv.innerHTML = ''; // Clear previous entries
            categories.forEach(category => {
                if (!isCategoryAlreadyDisplayed(category.name)) {
                    const catDiv = document.createElement('div');
                    catDiv.classList.add('category-display', category.color);
                    catDiv.innerHTML = `<strong>${category.name}</strong>: ${category.words.join(', ')}`;
                    gameOverCategoriesDiv.appendChild(catDiv);
                }
            });
        }

        function isCategoryAlreadyDisplayed(categoryName) {
            const displayedCategories = resultsArea.querySelectorAll('.category-display strong');
            for (let displayedCat of displayedCategories) {
                if (displayedCat.textContent === categoryName) {
                    return true;
                }
            }
            return false;
        }


        function disableGameControls() {
            shuffleButton.disabled = true;
            deselectButton.disabled = true;
            submitButton.disabled = true;
            document.querySelectorAll('.word-button').forEach(button => {
                button.disabled = true;
            });
        }

        function enableGameControls() {
            shuffleButton.disabled = false;
            deselectButton.disabled = false;
            submitButton.disabled = false;
            // Word buttons are enabled/disabled individually or via renderWordGrid
        }

        // --- Event Listeners ---
        shuffleButton.addEventListener('click', () => {
            // Collect only words that are NOT part of a found category
            const wordsToShuffle = [];
            document.querySelectorAll('#word-grid .word-button:not([style*="visibility: hidden"])').forEach(btn => {
                wordsToShuffle.push(btn.dataset.word);
            });

            shuffleArray(wordsToShuffle); // Shuffle the remaining words

            // Re-populate the grid with the shuffled order of remaining words
            const gridButtons = Array.from(document.querySelectorAll('#word-grid .word-button'));
            let shuffleIndex = 0;
            gridButtons.forEach(button => {
                if (button.style.visibility !== 'hidden') { // Only update visible buttons
                    if (shuffleIndex < wordsToShuffle.length) {
                        button.textContent = wordsToShuffle[shuffleIndex];
                        button.dataset.word = wordsToShuffle[shuffleIndex];
                        shuffleIndex++;
                    }
                }
            });
            deselectAllWords(); // Deselect after shuffle
        });

        deselectButton.addEventListener('click', deselectAllWords);
        submitButton.addEventListener('click', handleSubmit);

        // --- Initialize ---
        initializeGame();

    </script>
    <style>
        /* Add shake animation for incorrect guesses */
        .shake-animation {
            animation: shake 0.5s;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
        }
    </style>
</body>
</html>
